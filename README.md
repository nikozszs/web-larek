# Проектная работа "Веб-ларек"

## 1 Используемый стек : 

```
HTML, SCSS, TS, Webpack
```

## 2.1 Установка и запуск

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## 2.2 Сборка

```
npm run build

yarn build
```

## 3 Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

### Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## 4 Архитектура приложения

Архитектура проекта разрабатывается с использованием паттерна MVP (Model-View-Presenter), в котором основными слоями являются: 

M - модели данных, отвечающие за работу с данными, 

V - компоненты представления - отвечающие за отображение данных на экране, 

P - презентер в роли EventEmitter, его код не будет выделен в отдельный класс, а будет содержаться в основном скрипте приложения index.ts.


## 5 Данные и типы данных, используемые в приложении

### Карточка

```
interface IProduct {
    id: string,
    title: string,
    price: number,
    image: string,
    category: CategoryStatus,
    description: string,
    totalPrice: number;
}
```

### Пользователь

```
interface IUser {
    address: string;
    email: string;
    phone: number;
    payment: string;
}
```

Интерфейс для модели данных карточек

```
interface IProductsData {
    products: IProduct[];
    preview: string | null;
}
```

Модальное окно товара

```
type modalProduct = Pick<IProduct, 'id' | 'image' | 'price' | 'title' | 'description' | 'category'>;
```

Модальное окно корзины

```
type modalBasket = Pick<IProduct, 'id' | 'price' | 'title'>;
```

Модальное окно формы оплаты

```
type modalPayment = Pick<IUser, 'address' | 'payment'>;
```

Модальное окно формы контактов

```
export type modalContacts = Pick<IUser, 'email' | 'payment' | 'phone'>;
```

Модальное окно успешной покупки

```
export type modalSuccess = Pick<IProduct, 'title' | 'totalPrice'>;
```
Интерфейс для модели данных пользователя

~~~
export interface IUserData {
    getInfo(): ModalContacts | ModalPayment;
    setInfo(userData: IUser): void;
    checkUserValidation(data: Record<keyof ModalContacts | keyof ModalPayment, string>): boolean;
}
~~~


## 6 Описание базовых классов

#### Класс Api имеет следующие свойства и методы.

Методы:

```
handleResponse(response: Response): Promise<object> - обработчик ответа сервера.
get(uri: string) - принимает изменяющеюся часть url-адреса, возвращает ответ от сервера.
post(uri: string, data: object, method: ApiPostMethods = 'POST') - принимает изменяющеюся часть url-адреса, принимает данные в виде объекта для отправки на сервер, type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'.
```

#### Класс EventEmitter - брокер событий, реализуется от интерфейса от IEvents и имеет следующие методы.

Методы:

```
on - для подписки на событие.
off - для отписки от события.
emit - уведомления подписчиков о наступлении события соответственно.
onAll - для подписки на все события.
offAll - сброса всех подписчиков.
trigger - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter.
```

## 7 Слой данных

### Класс ProductsData

Класс отвечает за хранение и логику работы с данными карточек, которые приходят с сервера. В полях класса хранятся следующие данные:
- _products: IProduct[] - массив объектов карточек
- _preview: string | null - id карточки, выбранной дляя просмотра в модальном окне
- events: IEvent - экземпляр класса 'EventEmitter' для инициации событий при изменении данных

Также класс предоставляет набор методов:
- deleteProduct(id: string): void - удаляет карточку из массива. Если передан колбек, то выполняет его после удаления, если нет, то вызывает событие изменения массива
- getProduct(id: string): IProduct - вовзращает карточку по ее id
- а также сеттеры и геттеры для сохранения и получения данных из полей класса

### Класс UserData
Класс отвечает за хранение и логику работы с данными текущего пользователя и формами contacts и order. В полях класса хранятся следующие данные:
- events: IEvent - экземпляр класса 'EventEmitter' для инициации событий при изменении данных
- address: string - адрес пользователя
- email: string - имеил пользователя
- phone: number - телефон пользователя
- payment: string - способ оплаты

Также класс предоставляет набор методов:
- getInfo(): ModalContacts | ModalPayment - возвращает основные данные пользователя, отображаемые на сайте
- setInfo(userData: IUser): voi - устанавливает данные
- getProduct(id: string): IProduct - вовзращает карточку по ее id

### Класс BasketData
Класс отвечает за хранение и логику работы с данными корзины. В полях класса хранятся следующие данные:
- _basketProducts: IProduct[] - массив объектов карточек в корзине

Кроме того, класс предоставляет набор методов:
- clearBasket(): void - очищение корзины
- getCounter: () => number - счетчик продуктов в корзине
- products: IProduct[]; - массив объектов карточек в корзине
- deleteProduct(value: IProduct): void - удаление товара из корзины
- selectedProduct(data: IProduct): void - добавление карточки в корзину
- totalPrice: () => number- итоговая цена корзины

### Класс ShopAPI
Класс отвечает за хранение данных с сервера. В полях класса хранятся следующие данные:
- readonly cdn: string - переменная с файлом картинки для карточки продукта

Также класс имеет свои методы:
- getProducts(): Promise<IProduct[]> - получить промис массива карточек
- getProduct(id: string): Promise<IProduct> - получить промис одной карточки по его id
- orderProducts(order: IOrder):Promise<IOrderResult> - получить список товаров, находящихся в корзине, через промис
- deleteProduct(id: string): Promise<IProduct> - удалить карточку через id


## Слой представления

### Класс FormOrder
Расширяет класс Modal. Предназначен для реализации модального окна  с формой содержащей поля ввода адреса и выбора формы оплаты. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. Поля класса: 
- submitButton: HTMLButtonElement - кнопка подтвреждения
- formOrder: HTMLFormElement - элемент формы order
- payment: string - способ оплаты
- errors: HTMLElement - отображение ошибок 
- paymentButton: HTMLButtonElement[] - 2 кнопки способа оплаты

Методы:
- set _errors(value: boolean) - при ошибке не разрешает переходить в след окно заказа

- set _payment(select: String) - выбор способа оплаты

- render() - отображает итоговую форму order


### Класс FormContacts
Расширяет класс Modal. Предназначен для реализации модального окна  с формой содержащей поля ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. Поля класса: 
- submitButton: HTMLButtonElement - кнопка подтвреждения
- formContacts: HTMLFormElement - элемент формы
- inputs: HTMLInputElement[] - коллекция всех полей ввода формы
- errors: HTMLElement - отображение ошибок 

Методы:
- set _errors(value: boolean) - при ошибке не разрешает переходить в след окно заказа

- render() - отображает итоговую форму контакс

### Класс CardCatalog для главной страницы
Расширяет класс CardBase и наследуюет от него поля:

- title: HTMLElement - название карточки
- price: HTMLElement - цена карточки
- events: IEvents - событие карточки (клик, сабмит или удаление)
- id: string - айди карточки

Отвечает за отображение карточки, задавая в карточке данные названия,изображения, категории, количество синапсов. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливается слушатель на интерактивный элемент, в результате взаимодействия с которым генерируется соответсвующее событие - открытие модального окна превью карточки. Поля класса содержат элементы разметки карточки. конструктор, кроме темплейта, принимает экземпляр 'EventEmitter' для инициации событий.

Методы: 

- render(data: Partial<CardGallary>): HTMLElement - возвращает отрисованную карточку
- get image(): string - получить изображение карточки
- set image(value: string) - установить изображение
- set category(value: string) -установить категорию карточки 


### Класс CardBasket 
Наследуется от класса CardBase и перенимает его поля. К ним добавляются новые:
- index: HTMLElement - отображение номера списка в корзине для карточки
- deletebutton: HTMLButtonElement - кнопка удаления карточки из корзины
Данный класс отображает карточку в корзине и выдается на странице списком.

Методы:
- set index(value: number) - установить порядковый номер списка корзины
- setPrice(value: number | null) - установить цену у карточки
- render(data: Partial<TCardBasket>): HTMLElement - вернуть отрисованную карточку для корзины

### Класс CardPreview
Наследуется от класса CardCatalog, добавляются поля такие как:
- description: HTMLElement - описание карточки 
- button: HTMLButtonElement - кнопка купить 

Методы: 
- set description(value: string | string[]) - установить описание карточки в превью
- render(data: Partial<PreviewCard>): HTMLElement - отрисовка карточки в модальном окне в превью версии

## Слой коммуникации

### Класс ShopApi
Принимает в конструктор экземпляр класса Арi и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.
Код, описывающий взаимодействие представления и данных между собой находится в файле 'index.ts', выполняющем роль презентера. В 'index.ts' сначала создаются экземпляры всех необходимый классов, а затем настраивается обработка событий.

Список изменения данных (генерируются классами моделями данных):
- 'user:changed' - изменение данных пользователя
- 'products:changed' - изменение массива карточек
- 'product:selected' - изменение открываемой в модальном окне превью карточки
- 'PreviewCard:open' - открытие модального окна превью товара
- 'order:delete' - удалить заказ в корзине
- 'order:open' - оформить заказ в корзине
- 'cardBasket:remove' - удалить заказ в корзине
- 'basketModal:open' - открыть модальное окно корзины по клику
- 'success:open' - открыть успешное окно
- 'contacts:changeInput' - изменить поле в форме контактов


Данные:
пользователь: адрес доставки, емаил, телефон, способ оплаты Действия: ввести доставку, ввести номер и емаил, выбор оплаты, очистка данных
карточка: статус, тайтл, ссылка на картинку, прайс, описание, айди, тотал прайс, Действия: удалить карточку, добавить в корзину, открывать превью карточки
массив карточек: cards - массив(записывать и получать массив), preview(свойсвто, в котором хранится id выбранной карточки в отдельном попапе), действия: удалить каротчку, обновить карточку, получить картоку, checkValidation
ЕСТЬ коллекция карточек, действия: добавить массив карточек с сервера
Пользовательский сценарий: карточка в корзину, из корзины в способ оплаты, ввод данных пользователя
Компоненты: 
1. модальное окно товара(статус, тайтл, описание, прайс, добавиление в корзину, закрытие попапа карточки)
2. модальное окно корзины(тайтл, прайс, оформление заказа, удаление товара, тотал прайс, закрытие попапа)
3. модальное окно формы оплаты(табс, адрес, закрытие попапа)
4. модальное окно формы контактов(емаил, тел, закрытие попапа, переход к оплате)
5. модальное окно успешной покупки(тайтл, тотал прайс, возвращение к гл странице)
6. карточка с данными
7. тех модель состояния
8. гл страница(карточки)

