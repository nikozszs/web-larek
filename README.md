# Проектная работа "Веб-ларек"

## 1 Используемый стек : 

```
HTML, SCSS, TS, Webpack
```

## 2.1 Установка и запуск

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## 2.2 Сборка

```
npm run build

yarn build
```

## 3 Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

### Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## 4 Архитектура приложения

Архитектура проекта разрабатывается с использованием паттерна MVP (Model-View-Presenter), в котором основными слоями являются: 

M - модели данных, отвечающие за работу с данными, 

V - компоненты представления - отвечающие за отображение данных на экране, 

P - презентер в роли EventEmitter, его код не будет выделен в отдельный класс, а будет содержаться в основном скрипте приложения index.ts.


## 5 Данные и типы данных, используемые в приложении

### Карточка

```
interface IProduct {
    id: string,
    title: string,
    price: number,
    image: string,
    category: CategoryStatus,
    description: string,
    totalPrice: number;
}
```

### Пользователь

```
interface IUser {
    address: string;
    email: string;
    phone: number;
    payment: string;
}
```

Интерфейс для модели данных карточек

```
interface IProductsData {
    products: IProduct[];
    preview: string | null;
}
```

Модальное окно товара

```
type modalProduct = Pick<IProduct, 'id' | 'image' | 'price' | 'title' | 'description' | 'category'>;
```

Модальное окно корзины

```
type modalBasket = Pick<IProduct, 'id' | 'price' | 'title'>;
```

Модальное окно формы оплаты

```
type modalPayment = Pick<IUser, 'address' | 'payment'>;
```

Модальное окно формы контактов

```
export type modalContacts = Pick<IUser, 'email' | 'payment' | 'phone'>;
```

Модальное окно успешной покупки

```
export type modalSuccess = Pick<IProduct, 'title' | 'totalPrice'>;
```
Интерфейс для модели данных пользователя

~~~
export interface IUserData {
    getInfo(): ModalContacts | ModalPayment;
    setInfo(userData: IUser): void;
    checkUserValidation(data: Record<keyof ModalContacts | keyof ModalPayment, string>): boolean;
}
~~~


## 6 Описание базовых классов

#### Класс Api имеет следующие свойства и методы.

Методы:

```
handleResponse(response: Response): Promise<object> - обработчик ответа сервера.
get(uri: string) - принимает изменяющеюся часть url-адреса, возвращает ответ от сервера.
post(uri: string, data: object, method: ApiPostMethods = 'POST') - принимает изменяющеюся часть url-адреса, принимает данные в виде объекта для отправки на сервер, type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'.
```

#### Класс EventEmitter - брокер событий, реализуется от интерфейса от IEvents и имеет следующие методы.

Методы:

```
on - для подписки на событие.
off - для отписки от события.
emit - уведомления подписчиков о наступлении события соответственно.
onAll - для подписки на все события.
offAll - сброса всех подписчиков.
trigger - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter.
```

## 7 Слой данных

### Класс ProductsData

Класс отвечает за хранение и логику работы с данными карточек, которые приходят с сервера. В полях класса хранятся следующие данные:
- _products: IProduct[] - массив объектов карточек
- _preview: string | null - id карточки, выбранной дляя просмотра в модальном окне
- events: IEvent - экземпляр класса 'EventEmitter' для инициации событий при изменении данных

Также класс предоставляет набор методов:
- deleteProduct(id: string): void - удаляет карточку из массива. Если передан колбек, то выполняет его после удаления, если нет, то вызывает событие изменения массива
- updateProduct(product: IProduct, payload: Function | null): void - обновляет данные карточки в массиве. Если передан колбек, то выполняет его после обновления, если нет, то вызывает событие изменение массива
- getProduct(id: string): IProduct - вовзращает карточку по ее id
- checkValidation(data: Record<keyof ModalPayment | keyof ModalContacts, string>): boolean - проверяет объект с данными карточки на валидность
- а также сеттеры и геттеры для сохранения и получения данных из полей класса

### Класс UserData
Класс отвечает за хранение и логику работы с данными текущего пользователя. В полях класса хранятся следующие данные:
- events: IEvent - экземпляр класса 'EventEmitter' для инициации событий при изменении данных
- address: string - адрес пользователя
- email: string - имеил пользователя
- phone: number - телефон пользователя
- payment: string - способ оплаты

Также класс предоставляет набор методов:
- getInfo(): ModalContacts | ModalPayment - возвращает основные данные пользователя, отображаемые на сайте
- setInfo(userData: IUser): voi - устанавливает данные
- getProduct(id: string): IProduct - вовзращает карточку по ее id
- checkUserValidation(data: Record<keyof ModalContacts | keyof ModalPayment, string>): boolean - проверяет объект с данными пользователя на валидность

## Слой представления
### Класс Modal 
Реализует модальное окно, а также предоставляет методы 'open' и 'close' для управления отображения модального окна. Устанавливает слушатели, для закрытия модального окна по кнопке-крестик. Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса 'EventEmitter' для возможности инициации событий.
Поля класса:
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

### Класс ModalContacts
Расширяет класс Modal. Предназначен для реализации модального окна  с формой содержащей поля ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. Поля класса: 
- submitButton: HTMLButtonElement - кнопка подтвреждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута названия формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект, хранящий все элементы для вывода ошибок под полями формы

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы 
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError(field: string):void - очищает текст ошибки под указанным полем ввода
- close(): void - расширяет родительский метод дополнительно при закрытии, очищая поля формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы

### Класс Product для главной страницы
Отвечает за отображение карточки, задавая в карточке данные названия,изображения, категории, количество синапсов. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливается слушатель на интерактивный элемент, в результате взаимодействия с которым генерируется соответсвующее событие - открытие модального окна превью карточки. Поля класса содержат элементы разметки карточки. конструктор, кроме темплейта, принимает экземпляр 'EventEmitter' для инициации событий.

Методы: 
- setData(productData: IProduct, userId: string): void - заполняет атрибуты элементов карточки данными
- render(): HTMLElement - метод возвращает полностью заполненную карточкеу с установленными слушателями
- геттер id - возвращает уникальный id карточки

### Класс ProductsContainer 
Отвечает за отображение блока с карточками на главной странице. Предоставляет метод 'addCards(cardElement: HTMLElement)' для добавления карточек на страницу и сеттер 'container' для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.

## Слой коммуникации

### Класс ShopApi
Принимает в конструктор экземпляр класса Арi и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.
Код, описывающий взаимодействие представления и данных между собой находится в файле 'index.ts', выполняющем роль презентера. В 'index.ts' сначала создаются экземпляры всех необходимый классов, а затем настраивается обработка событий.

Список изменения данных (генерируются классами моделями данных):
- 'user:changed' - изменение данных пользователя
- 'products:changed' - изменение массива карточек
- 'product:selected' - изменение открываемой в модальном окне превью карточки
- 'PreviewCard:open' - открытие модального окна превью товара

Список событий, возникающих при взаимодействии пользователя с интерфейсом

- '...:open'
- '...:input' для конкретного поля
- '...:submit'
- '...:validation'
- '...:select'
- '...:delete'
- '...:clear'


Данные:
пользователь: адрес доставки, емаил, телефон, способ оплаты Действия: ввести доставку, ввести номер и емаил, выбор оплаты, очистка данных
карточка: статус, тайтл, ссылка на картинку, прайс, описание, айди, тотал прайс, Действия: удалить карточку, добавить в корзину, открывать превью карточки
массив карточек: cards - массив(записывать и получать массив), preview(свойсвто, в котором хранится id выбранной карточки в отдельном попапе), действия: удалить каротчку, обновить карточку, получить картоку, checkValidation
ЕСТЬ коллекция карточек, действия: добавить массив карточек с сервера
Пользовательский сценарий: карточка в корзину, из корзины в способ оплаты, ввод данных пользователя
Компоненты: 
1. модальное окно товара(статус, тайтл, описание, прайс, добавиление в корзину, закрытие попапа карточки)
2. модальное окно корзины(тайтл, прайс, оформление заказа, удаление товара, тотал прайс, закрытие попапа)
3. модальное окно формы оплаты(табс, адрес, закрытие попапа)
4. модальное окно формы контактов(емаил, тел, закрытие попапа, переход к оплате)
5. модальное окно успешной покупки(тайтл, тотал прайс, возвращение к гл странице)
6. карточка с данными
7. тех модель состояния
8. гл страница(карточки)

