# Проектная работа "Веб-ларек"

## 1 Используемый стек : 

```
HTML, SCSS, TS, Webpack
```

## 2.1 Установка и запуск

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## 2.2 Сборка

```
npm run build

yarn build
```

## 3 Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

### Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## 4 Архитектура приложения

Архитектура проекта разрабатывается с использованием паттерна MVP (Model-View-Presenter), в котором основными слоями являются: 

M - модели данных, отвечающие за работу с данными, 

V - компоненты представления - отвечающие за отображение данных на экране, 

P - презентер в роли EventEmitter, его код не будет выделен в отдельный класс, а будет содержаться в основном скрипте приложения index.ts.


## 5 Данные и типы данных, используемые в приложении

Статусы категорий товаров:

```
type CategoryStatus = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```
Основной интерфейс товара:

```
interface IProduct {
    id: string,
    title: string,
    price: number,
    image: string,
    category: CategoryStatus,
    description: string,
    total: number,
    index:  number,
    button: string
}
```

Интерфейс состояния приложения:

```
interface IAppState {
    catalog: ProductsCatalog[];
    order: IOrder;
    errors: FormErrors;
    preview: string;
    loading: boolean;
    setPreview(item: PreviewCard): void;
}
```

Интерфейс действий на реакции пользователя:

```
interface IActions {
    onClick?: (event: MouseEvent) => void;
    onSubmit?: (price: number) => void;
    onDelete?: (event: MouseEvent) => void
}
```

Типизирование карточек для каталога:

```
type ProductsCatalog = Pick<IProduct, 'id' | 'image' | 'price' | 'title' | 'category'>;
```

Типизирование карточек для превью:

```
type PreviewCard = Pick<IProduct, 'id' | 'image' | 'price' | 'description'| 'title' | 'category'>;
```

Типизирование карточек для корзины:

```
type BasketCard = Pick<IProduct, 'id' | 'price' | 'title' | 'index' | 'total'>;
```

Интерфейс для типизации значений, вводимых в инпуты заказа:

```
interface IOrderForm {
    email: string;
    phone: string;
    address: string;
    payment: string;
}
```

Интерфейс заказа для корзины:

```
interface IOrder extends IOrderForm {
    total?: number;
    items: BasketCard[];
}
```

Типизирование ошибок в инпутах заказа:

```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Интерфейс результата заказа:

```
interface IOrderResult {
    id: string;
}
```


## 6 Описание базовых классов

#### Класс Api имеет следующие свойства и методы.

Методы:

```
handleResponse(response: Response): Promise<object> - обработчик ответа сервера.
get(uri: string) - принимает изменяющеюся часть url-адреса, возвращает ответ от сервера.
post(uri: string, data: object, method: ApiPostMethods = 'POST') - принимает изменяющеюся часть url-адреса, принимает данные в виде объекта для отправки на сервер, type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'.
```

#### Класс EventEmitter - брокер событий, реализуется от интерфейса от IEvents и имеет следующие методы.

Методы:

```
on - для подписки на событие.
off - для отписки от события.
emit - уведомления подписчиков о наступлении события соответственно.
onAll - для подписки на все события.
offAll - сброса всех подписчиков.
trigger - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter.
```

## 7 Слой данных

### Класс ProductsModel

Класс отвечает за хранение и логику работы с данными карточек, которые приходят с сервера. В полях класса хранятся следующие данные:
- catalog: ProductsCatalog[] - массив объектов карточек
- preview: string | null - id карточки, выбранной дляя просмотра в модальном окне


Также класс предоставляет набор методов:
- getCatalog(): ProductsCatalog[] - метод для получения карточек каталога

- setCatalog(data: ProductsCatalog[]) - установить данные карточек каталога

- getPreview(): PreviewCard | null - получить данные для карточки превью

- setPreview(item: PreviewCard)- установить данные для карточки превью

### Класс BasketData

Класс отвечает за хранение и логику работы с данными корзины и формами contacts и order. В полях класса хранятся следующие данные:
- order: IOrder = {
            email: '',
            phone: '',
            address: '',
            payment: '',
            items:[]
    } - данные заказа
- total: number - итоговая сумма заказа
- items: BasketCard[] - массив карточек типизированных
- formErrors: FormErrors = {} - обработка ошибок в форме 
- price: number - цена товара
- address: string - адрес пользователя
- email: string - имеил пользователя
- phone: number - телефон пользователя
- payment: string - способ оплаты

Также класс предоставляет набор методов:
- clearBasket() - очистка корзины
- addCardBasket(item: IProduct) - добавить карточку в корзину
- updateIndex() - обновить индекс в корзине у товара
- deleteCardBasket(items: BasketCard) - удалить карточку из корзины
- getButton(item: IProduct) - логика описания кнопок
- getCounter() - подсчет количества товаров 
- set products(data: BasketCard[]) - установить данные товаров
- getProductsOrder(): BasketCard[] - получить данные заказа
- getTotalPrice() - получить итоговую стоимость товаров
- setContacts(field: string, value: string): void - установить данные, введенные пользователем в форме контактов
- setAddress(field: string, value: string): void - установить данные, введенные пользователем в форме заказа
- getOrder() - получить данные заказа
- validateContacts(): boolean - валидирование формы контактов
- validateOrder(): boolean - валидирование формы заказа
- validateBasket(): boolean - валидирование корзины на количество товаров


### Класс ShopAPI
Класс отвечает за хранение данных с сервера. В полях класса хранятся следующие данные:
- readonly cdn: string - переменная с файлом картинки для карточки продукта

Также класс имеет свои методы:
- getProducts(): Promise<IProduct[]> - получить промис массива карточек
- getProduct(id: string): Promise<IProduct> - получить промис одной карточки по его id
- orderProducts(order: IOrder):Promise<IOrderResult> - получить список товаров, находящихся в корзине, через промис
- deleteProduct(id: string): Promise<IProduct> - удалить карточку через id


## Слой представления

### Класс Form
Базовый класс для работы с HTML-формами. Обеспечивает: обработку ввода данных, валидацию формы, управление состоянием кнопки отправки, отображение ошибок. Поля:
_submit: HTMLButtonElement - кнопка отправки формы
_errors: HTMLElement - контейнер для отображения ошибок
Методы: 
onInputChange(field: keyof T, value: string) - обработчик изменения полей ввода
set valid(value: boolean) - управление активностью кнопки отправки
set errors(value: string) - отображение ошибок валидации
reset() - сброс формы
render(state: Partial<T> & IFormState) - обновление состояния формы


### Класс FormOrder
Наследуется от класса Form. Предназначен для реализации модального окна  с формой содержащей поля ввода адреса и выбора формы оплаты. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления  активностью кнопки сохранения. Поля класса: 
- card: HTMLButtonElement - оплата онлайн
- cash: HTMLButtonElement - оплата при получении
- address: HTMLInputElement - поле ввода адреса
- submitButton: HTMLButtonElement - кнопка отправки формы
- selectedpayment: string - выбранный способ оплаты

Методы:
- selectPayment(type: 'card' | 'cash') - выбор способа оплаты
- updatePaymentButtons() - обновление состояния кнопок оплаты
- submitOrder() - обработка отправки формы
- validateForm() - валидация данных формы
- set _address(value: string) - установка значения адреса

### Класс FormContacts
Наследуется от класса Form. Предназначен для реализации модального окна  с формой содержащей поля ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. Поля класса: 
- email: HTMLInputElement - поле ввода email
- phone: HTMLInputElement - поле ввода телефона
Методы: 
- set _phone(value: string) - установка значения телефона
- set _email(value: string) - установка значения email

### Класс CardBase
Базовый класс для всех типов карточек: обеспечивает общую функциональность, отображение названия и цены, управление идентификаторомБ базовую структуру компонента. Поля класса:
- _title: HTMLElement - элемент названия карточки
- _price: HTMLElement - элемент цены
- _id: string - уникальный идентификатор карточки
Методы:
- set id(value: string) - установка идентификатора
- get id(): string - получение идентификатора
- set title(value: string) - установка названия
- get title(): string - получение названия
- set price(value: number | null) - установка цены ("Бесценно" для null)

### Класс CardCatalog для главной страницы
Наследует класс CardBase.
Отвечает за отображение карточки, задавая в карточке данные названия,изображения, категории, количество синапсов. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливается слушатель на интерактивный элемент, в результате взаимодействия с которым генерируется соответсвующее событие - открытие модального окна превью карточки. Поля класса содержат элементы разметки карточки. конструктор, кроме темплейта, принимает экземпляр 'EventEmitter' для инициации событий.
Поля:
- _image: HTMLImageElement - изображение товара
- _category: HTMLElement - категория товара
Методы: 

Методы: 
- set image(value: string) - установка изображения
- set category(value: string) - установка категории

### Класс CardBasket 
Наследуется от класса CardBase, реализует карточку товара в корзине. Поля: 
- index: HTMLElement - отображение номера списка в корзине для карточки
- deletebutton: HTMLButtonElement - кнопка удаления карточки из корзины
Данный класс отображает карточку в корзине и выдается на странице списком.

Методы:
- set index(value: number) - установить порядковый номер списка корзины

### Класс CardPreview
Наследуется от класса CardCatalog, реализует карточку товара в превью. Добавляются поля такие как:
- description: HTMLElement - описание карточки 
- button: HTMLButtonElement - кнопка купить 

Методы: 
- set description(value: string | string[]) - установить описание карточки в превью
- set button(value: string) - установка текста кнопки

### Класс Basket
Наследуется от Component. Отвечает за отображение и управление корзиной товаров. Обеспечивает: отображение списка товаров в корзине, подсчёт и отображение общей суммы, управление состоянием кнопки оформления заказа, очистку корзины.
Поля:
- list: HTMLElement - контейнер для списка товаров
- _total: HTMLElement - элемент отображения общей суммы
- submitbutton: HTMLButtonElement - кнопка оформления заказа
- _items: HTMLElement[] - массив элементов товаров в корзине (приватное поле)

Методы:

- get items(): HTMLElement[] - возвращает копию массива элементов товаров
- set items(items: HTMLElement[]) - обновляет список товаров в корзине
- handleSubmit(): void - обработчик оформления заказа
- updateHandleSubmit(): void - обновляет состояние кнопки оформления
- setTotal(value: number | null): void - устанавливает общую сумму
- clear(): void - очищает корзину

### Класс Modal
Наследуется от Component. Реализует функциональность модального окна: управление открытием/закрытием, отображение контент, обработку событий
Поля:

- _closeButton: HTMLButtonElement - кнопка закрытия модального окна
- _content: HTMLElement - контейнер для содержимого модального окна

Методы:

- set content(value: HTMLElement) - устанавливает содержимое модального окна
- open() - открывает модальное окно
- close() - закрывает модальное окно
- render(data: IModalData) - отрисовывает и открывает модальное окно

### Класс Page
Наследуется от Component. Управляет основными элементами страницы: счетчиком товаров в корзине, отображением каталога товаров, блокировкой страницы при открытых модальных окнах, кнопкой корзины в хедере.
Поля:
- _counter: HTMLElement - элемент счетчика товаров в корзине
- _catalog: HTMLElement - контейнер каталога товаров
- _wrapper: HTMLElement - основной контейнер страницы
- _basket: HTMLElement - кнопка/иконка корзины в хедере

Методы:
- set counter(value: number) - устанавливает значение счетчика корзины
- set catalog(items: HTMLElement[]) - обновляет содержимое каталога
- set locked(value: boolean) - блокирует/разблокирует прокрутку страницы

### Класс Success
Наследуется от Component. Отвечает за отображение и управление окном успешного оформления заказа.
Поля:
- _close: HTMLElement - кнопка закрытия окна успешного оформления

## Слой коммуникации

### Класс ShopApi
Принимает в конструктор экземпляр класса Арi и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.
Код, описывающий взаимодействие представления и данных между собой находится в файле 'index.ts', выполняющем роль презентера. В 'index.ts' сначала создаются экземпляры всех необходимый классов, а затем настраивается обработка событий.

Список изменения данных (генерируются классами моделями данных):
- 'products:changed' - изменение карточек в каталоге на главной странице
- 'card:select' - выбор карточки из каталога
- 'basketModal:open' - открытие модального окна корзины
- 'basket:changed' - изменение данных к корзине
- 'preview:changed' - изменение карточки превью
- 'card:deleteBasket' - удаление карточки в корзине
- 'card:addBasket' - добавление карточки в корзину
- 'payment:changed' - изменение кнопок способа оплаты
- 'order:open' - открытие окна заказа с адресом и способа оплаты
- 'order:submit' - Обработчик отправки формы заказа
- 'contacts:open' - открытие окна с имеилом и телефоном
- 'order:changed' - изменение заказа
- 'formErrors:changed' - обработчик ошибок форм
- /^order\..*:change/ - изменилось одно из полей